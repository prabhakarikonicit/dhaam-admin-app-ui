import React, { useState } from "react";
import CustomModal, { FieldDefinition } from "../../../common/modals";

interface ZapierProps {
  onLearnMore?: () => void;
}

const Zapier: React.FC<ZapierProps> = ({ onLearnMore }) => {
  const [isConnected, setIsConnected] = useState(true);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalMode, setModalMode] = useState<"edit" | "add" | "delete">(
    "delete"
  );

  // Current item for the modal
  const [currentItem, setCurrentItem] = useState({
    id: "zapier-connection",
    name: "Zapier Connection",
    isActive: true,
  });

  // Empty fields array since we're just using it for confirmation
  const zapierFields: FieldDefinition[] = [];

  const handleDisconnect = () => {
    setModalMode("delete");
    setCurrentItem({
      id: "zapier-connection",
      name: "Zapier Connection",
      isActive: true,
    });
    setIsModalOpen(true);
  };

  const handleSave = () => {
    // For delete mode, disconnect the account
    if (modalMode === "delete") {
      setIsConnected(false);
    } else if (!isConnected) {
      setIsConnected(true);
    }
    setIsModalOpen(false);
  };

  const handleConnect = () => {
    // In a real app, this would trigger authentication flow with Zapier
    setIsConnected(true);
  };

  return (
    <div className="max-w-full">
      <div className="mt-0 mt-0 sm:mt-12 md:mt-12 lg:mt-12 md:px-1 sm:px-1 lg:px-1 xl:px-1 rounded-md">
        <div className="flex justify-between items-center">
          <h1 className="text-[14px] font-inter font-[600] text-headding-color">Zapier</h1>
          <button
            onClick={onLearnMore}
            className="text-[12px] font-inter font-[600] text-paragraphBlack"
          >
            Learn More
          </button>
        </div>

        <div className="mt-4 flex items-center bg-backgroundWhite p-6 rounded-custom12px justify-between">
          <div className="flex items-center">
            <div className="mr-3">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="50"
                height="22"
                viewBox="0 0 50 22"
                fill="none"
              >
                <path
                  d="M29.8066 9.56804H28.6092C28.5846 9.47005 28.5663 9.3564 28.5541 9.22738C28.5297 8.97627 28.5297 8.72338 28.5541 8.47227C28.5663 8.34354 28.5846 8.22998 28.6092 8.13141H31.5932V17.5802C31.4438 17.6061 31.2932 17.6245 31.1419 17.6351C30.9917 17.6466 30.8411 17.6527 30.6904 17.6534C30.5461 17.6525 30.4018 17.6464 30.2579 17.6351C30.1067 17.6244 29.9562 17.606 29.8068 17.5799V9.56766V9.56785L29.8066 9.56804ZM40.1943 11.9442C40.1943 11.6003 40.1482 11.2719 40.0563 10.9586C39.9641 10.6457 39.8287 10.3725 39.6511 10.1391C39.4727 9.90602 39.2457 9.71859 38.9694 9.57746C38.6932 9.43624 38.3646 9.36553 37.984 9.36553C37.2351 9.36553 36.6609 9.59302 36.262 10.0471C35.8629 10.5014 35.6205 11.1337 35.5344 11.9442H40.1944H40.1943ZM35.5161 13.3071C35.5407 14.3385 35.8077 15.0938 36.3173 15.5724C36.8267 16.0512 37.5789 16.291 38.5735 16.291C39.445 16.291 40.2739 16.1373 41.0598 15.8304C41.1578 16.0145 41.2375 16.2387 41.299 16.5027C41.3593 16.7597 41.3963 17.0216 41.4095 17.2853C41.0046 17.4577 40.5591 17.586 40.0744 17.6722C39.5891 17.7579 39.0519 17.8011 38.4629 17.8011C37.6031 17.8011 36.8662 17.681 36.2526 17.4418C35.6386 17.2021 35.1321 16.8645 34.733 16.4288C34.334 15.993 34.0423 15.4772 33.8581 14.8816C33.674 14.2862 33.5817 13.6323 33.5817 12.9201C33.5817 12.2202 33.6707 11.5663 33.8488 10.9584C34.0265 10.3509 34.3003 9.82282 34.6683 9.37465C35.0368 8.9263 35.5002 8.57036 36.059 8.30636C36.6174 8.04236 37.2773 7.91017 38.039 7.91017C38.6897 7.91017 39.2606 8.02084 39.7519 8.2418C40.2428 8.46276 40.6543 8.76672 40.9859 9.1535C41.3174 9.54037 41.5691 10.0008 41.741 10.5347C41.9128 11.069 41.9991 11.6491 41.9991 12.2755C41.9991 12.4474 41.9925 12.6284 41.9803 12.8187C41.9703 12.9815 41.958 13.1442 41.9436 13.3067H35.5157L35.5159 13.307L35.5161 13.3071ZM44.0077 8.13141C44.1359 8.10814 44.2649 8.08975 44.3945 8.07627C44.517 8.06426 44.6462 8.05802 44.7812 8.05802C44.9163 8.05802 45.0512 8.06426 45.1865 8.07627C45.3214 8.08876 45.4443 8.1072 45.5549 8.13141C45.5914 8.31568 45.6283 8.55844 45.665 8.85895C45.7018 9.15984 45.7205 9.41443 45.7205 9.62328C45.9783 9.20596 46.319 8.84348 46.7425 8.53644C47.1662 8.22969 47.7095 8.07598 48.3724 8.07598C48.4706 8.07598 48.5719 8.07925 48.6763 8.0854C48.7657 8.0902 48.855 8.09923 48.9434 8.11278C48.9678 8.22345 48.9866 8.34027 48.9987 8.46286C49.0108 8.58554 49.017 8.71456 49.017 8.84954C49.017 8.997 49.0078 9.15062 48.9895 9.3099C48.9718 9.46386 48.9503 9.61736 48.9251 9.77027C48.8256 9.74577 48.7235 9.73342 48.6211 9.73347H48.3722C48.0408 9.73347 47.7245 9.77959 47.4237 9.87153C47.1227 9.96375 46.8527 10.1265 46.6133 10.3596C46.3741 10.593 46.1836 10.9123 46.0426 11.3176C45.9011 11.7228 45.8307 12.2446 45.8307 12.883V17.5799C45.6813 17.6058 45.5307 17.6244 45.3794 17.635C45.2139 17.6473 45.0633 17.6533 44.9283 17.6533C44.7777 17.6527 44.6272 17.6466 44.477 17.635C44.3197 17.6236 44.1629 17.6052 44.0072 17.58V8.13151L44.0077 8.13141ZM31.0811 3.08621C31.0811 3.30666 31.0413 3.5253 30.9636 3.73161C30.7572 3.80932 30.5385 3.84915 30.318 3.8492H30.3153C30.0948 3.84922 29.8761 3.80942 29.6697 3.7317C29.5919 3.52536 29.552 3.30664 29.5521 3.08611V3.08323C29.5521 2.85602 29.5938 2.63843 29.6693 2.43764C29.8757 2.35981 30.0945 2.32001 30.315 2.32015H30.3175C30.5448 2.32015 30.7624 2.36184 30.9631 2.43764C31.0409 2.64399 31.0807 2.86271 31.0806 3.08323V3.08611H31.0809L31.0811 3.08621ZM33.3316 2.57512H31.547L32.8088 1.31324C32.6104 1.03459 32.3668 0.791057 32.0881 0.592715L30.8261 1.85459V0.0699027C30.6583 0.041676 30.4885 0.0274407 30.3183 0.0273438H30.315C30.1419 0.0273438 29.9724 0.0421385 29.8071 0.0699027V1.85459L28.5449 0.592619C28.4059 0.691559 28.2754 0.801977 28.1548 0.922715L28.1542 0.923291C28.0337 1.04394 27.9234 1.1744 27.8244 1.31334L29.0867 2.57512H27.3017C27.3017 2.57512 27.2593 2.9104 27.2593 3.08371V3.08582C27.2593 3.25913 27.274 3.42899 27.3018 3.59432H29.0868L27.8243 4.85601C28.0229 5.13462 28.2665 5.3782 28.5452 5.57672L29.8072 4.31494V6.09973C29.9723 6.1274 30.1415 6.142 30.3145 6.14219H30.3188C30.4888 6.14204 30.6584 6.12783 30.826 6.09973V4.31494L32.0882 5.57701C32.2272 5.47798 32.3578 5.36757 32.4785 5.24692H32.4788C32.5993 5.12614 32.7096 4.99558 32.8085 4.85658L31.5468 3.59442H33.3317C33.3594 3.42918 33.374 3.2599 33.374 3.08698V3.08256C33.374 2.91251 33.3598 2.74295 33.3317 2.57531L33.3316 2.57512ZM0.982422 17.3224L5.95538 9.58649H1.57171C1.53502 9.36553 1.51667 9.12016 1.51667 8.84992C1.51667 8.59216 1.5353 8.35247 1.5721 8.13132H8.66302L8.75524 8.3712L3.74549 16.1252H8.44196C8.47875 16.3708 8.49729 16.6224 8.49729 16.8801C8.49729 17.1261 8.47885 17.3592 8.44206 17.5802H1.07465L0.982422 17.3221V17.3224ZM15.3301 13.1412C15.1459 13.1169 14.9126 13.0926 14.6302 13.0677C14.3478 13.0434 14.1084 13.0309 13.9122 13.0309C13.1507 13.0309 12.5706 13.1721 12.1718 13.4545C11.7724 13.7372 11.5733 14.1667 11.5733 14.7438C11.5733 15.1121 11.6405 15.4007 11.7757 15.6094C11.9106 15.8184 12.0795 15.9777 12.2822 16.0883C12.4849 16.1988 12.7087 16.2664 12.9542 16.291C13.1996 16.3155 13.4331 16.3277 13.654 16.3277C13.9365 16.3277 14.2281 16.3123 14.5289 16.2816C14.8296 16.2511 15.0967 16.2049 15.3302 16.1435V13.1412H15.3301ZM15.3301 11.3548C15.3301 10.6301 15.1459 10.1267 14.7777 9.84424C14.4091 9.5618 13.8751 9.42058 13.1752 9.42058C12.7451 9.42058 12.3433 9.45458 11.9689 9.52203C11.5984 9.58852 11.2323 9.67761 10.8727 9.78881C10.6393 9.38359 10.523 8.89892 10.523 8.33374C10.94 8.19885 11.4003 8.09452 11.904 8.02084C12.4074 7.94706 12.8924 7.91017 13.3592 7.91017C14.587 7.91017 15.5201 8.18973 16.1587 8.74837C16.797 9.3075 17.1165 10.2007 17.1165 11.4283V17.3407C16.6865 17.4389 16.1648 17.5401 15.5509 17.6445C14.9302 17.7494 14.3018 17.8017 13.6723 17.8011C13.0707 17.8011 12.5271 17.7461 12.0424 17.6355C11.5572 17.5247 11.1458 17.3471 10.8083 17.1012C10.4703 16.8558 10.2097 16.5426 10.0253 16.1621C9.84122 15.7814 9.74909 15.321 9.74909 14.7806C9.74909 14.2528 9.85649 13.7892 10.0714 13.3899C10.2826 12.9954 10.582 12.6551 10.9464 12.3954C11.3147 12.1318 11.7383 11.935 12.2172 11.8063C12.6962 11.6773 13.1994 11.6127 13.7274 11.6127C14.1204 11.6127 14.4427 11.6221 14.6945 11.6406C14.946 11.6588 15.1579 11.6803 15.3299 11.7049V11.3549L15.3301 11.3548ZM20.929 16.0327C21.1615 16.1186 21.4023 16.1803 21.6474 16.2169C21.893 16.2539 22.2119 16.2723 22.6053 16.2723C23.0472 16.2723 23.4522 16.2019 23.8205 16.0606C24.1891 15.9197 24.5051 15.7015 24.7691 15.4067C25.0331 15.1121 25.2418 14.7409 25.3953 14.2923C25.5487 13.8444 25.6257 13.3135 25.6257 12.6992C25.6257 11.717 25.4443 10.9373 25.0823 10.3601C24.7198 9.78314 24.1274 9.49455 23.305 9.49455C22.9981 9.49455 22.7031 9.54969 22.4212 9.66037C22.1384 9.77085 21.8868 9.93666 21.6658 10.1576C21.4448 10.3786 21.2668 10.6581 21.1318 10.9957C20.9964 11.3337 20.9291 11.7355 20.9291 12.2022V16.033V16.0328L20.929 16.0327ZM19.1056 8.13122C19.2305 8.10663 19.3564 8.08828 19.4832 8.07608C19.6149 8.06389 19.747 8.0578 19.8793 8.05783C20.0017 8.05783 20.1305 8.06417 20.2659 8.07608C20.4007 8.08857 20.5297 8.10711 20.6526 8.13132C20.6647 8.1563 20.6803 8.23267 20.6987 8.36169C20.717 8.49072 20.7354 8.62877 20.754 8.77595C20.7724 8.92341 20.7908 9.06492 20.8092 9.19961C20.8277 9.33488 20.8369 9.42086 20.8369 9.45766C20.9594 9.26139 21.1068 9.07088 21.2788 8.88672C21.4508 8.70245 21.6567 8.53673 21.8961 8.38955C22.1355 8.24209 22.4054 8.12555 22.7064 8.03948C23.0071 7.95359 23.3417 7.91026 23.7101 7.91026C24.2626 7.91026 24.7753 8.00249 25.2482 8.18675C25.7207 8.3712 26.1256 8.65624 26.4635 9.04312C26.801 9.42999 27.0649 9.9212 27.2554 10.5165C27.4456 11.1126 27.5407 11.8154 27.5407 12.6257C27.5407 14.2464 27.1017 15.5145 26.2236 16.4291C25.3455 17.3439 24.1027 17.8011 22.4942 17.8011C22.2239 17.8011 21.9478 17.7827 21.6654 17.7459C21.3828 17.7089 21.1374 17.6597 20.9285 17.5986V21.927C20.773 21.9523 20.6163 21.9707 20.4591 21.9822C20.2932 21.9942 20.1427 22.0004 20.0076 22.0004C19.8571 21.9998 19.7066 21.9937 19.5565 21.9822C19.4053 21.9715 19.2547 21.953 19.1053 21.927V8.13132L19.1056 8.13122Z"
                  fill="#FF4A00"
                />
              </svg>
            </div>
            <div>
              <span className="text-[12px] font-inter font-[600] text-paragraphBlack">
                {isConnected ? "Account Connected" : "Not Connected"}
              </span>
            </div>
          </div>
          {isConnected ? (
            <button
              onClick={handleDisconnect}
              className="px-4 py-2 border border-gray-300 rounded-md text-[12px] font-inter font-[600] text-paragraphBlack"
            >
              Disconnect
            </button>
          ) : (
            <button
              onClick={handleConnect}
              className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm font-medium"
            >
              Connect
            </button>
          )}
        </div>
      </div>

      {/* CustomModal for disconnecting */}
      {isModalOpen && currentItem && (
        <CustomModal
          isOpen={isModalOpen}
          onClose={() => setIsModalOpen(false)}
          mode={modalMode}
          fields={zapierFields}
          item={currentItem}
          onSave={handleSave}
          title="Disconnect Zapier"
          subtitle="Are you sure you want to disconnect your Zapier account? This will disable any active Zaps associated with this connection."
          showToggle={false}
          toggleLabel="Active"
          confirmText="Disconnect"
          size="md"
        />
      )}
    </div>
  );
};

export default Zapier;
